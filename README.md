# ResNet20-Pruning
## Первый метод:
### Принцип работы
![image](https://user-images.githubusercontent.com/89237314/196045797-c7be578e-79b1-4308-83e4-b460ec527812.jpg)
Используя K-Means кластеризуем фильтры каждого сверточного слоя, таким образом получим центроиды кластеров (каждый центроид - фильтр). Используя вместо фильтров центроды удается сократить количесвто весов модели, но скорость её работы значительно увеличивается, так как каждый сверточный слой теперь не хранит привычный nn.Conv2d, применение свертки к изображению происходит таким образом: i-ый фильтр в свертки сначала заменяется центроидом, к которму принадлежит, а только потом приментяется к изображению.
На графике я привел время работы модели при увеличении сжатия (время засекалось на train части CIFAR10)
![compr_time_first](https://user-images.githubusercontent.com/89237314/196179443-cda55247-587b-46e6-b6af-d971ba24a2ac.png)
Модель стала работать медленнее, но количество параметров значительно упало
![params](https://user-images.githubusercontent.com/89237314/196180043-4eac2092-fa25-4309-bf6e-28298eb22d5c.png)
### Точность
После урезания модели её точность значительно упала, пришлось немного дообучить модель, чтобы оценить её точность
На графике приведена точность модель с коэффициентом сжатия 0.5
![train_first_05](https://user-images.githubusercontent.com/89237314/196180580-40dabc14-5274-403c-801c-6318114bcb43.png)
Далее я попробовал урезать модель на 90% и дообучить её
![train_first_09](https://user-images.githubusercontent.com/89237314/196180779-f3c1c519-9336-4fe8-a3da-f140a4a0433b.png)

Вывод: Спустя несколько эпох точность модели возрасла на 55% при том, что количество её весов в 10 раз меньше, чем у исходной модели ResNet20. 

## Второй метод:
Уменьшить количество весов удалось, но скорость из-за дополнительных операций упала. Было приянято решение отказаться от условия сохранения количества фильтров в каждом сверточном слое. Я решил применить кластеризацию к фильтрам первого сверточного слоя каждого residual блока, далее количство фильтров первого сверточного слоя изменялось, оставались только центроиды кластеров. Очевидно, что из-за изменения количесва фильтров feature map, которую принимает второй сверточный слой в residual блоке, имеет уже другие размеры. Таким образом, кроме уменьшения первого сверточного слоя, нужно уменьшить каждый фильтр второго сверточного слоя при этом запоминая, какие фильтры были обрезаны. Пример изменения residual блока я изобразил на картинке (красные цвета обозначают удаленные элементы)
![SecondModel](https://user-images.githubusercontent.com/89237314/196185868-02a3d3be-963c-4934-8bf4-cf869129d7e4.jpg)
Теперь при увеличении сжатия скорость модели росла. При урезании 80% весов модель справлялась с тестовой частью CIFAR10 за 13.5 секунд, в свою очередь оригинальная ResNet20 делала это за 20.5 секунд.
![compr_time_second](https://user-images.githubusercontent.com/89237314/196188526-854202e9-3e42-4468-8006-f47c96e24f4c.png)

